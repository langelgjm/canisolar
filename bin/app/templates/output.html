<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<!-- TODO: write a description -->
		<meta name="description" content="">
		<meta name="author" content="Gabriel J. Michael">
		<!-- TODO: include a favicon! -->
		<link rel="icon" href="../../favicon.ico">

		<title>Can I Solar?</title>

		<!-- Bootstrap core CSS -->
		<link href="../static/css/bootstrap.min.css" rel="stylesheet">
		<link href="../static/css/nv.d3.css" rel="stylesheet">
		<!-- Custom styles for this template -->
		<!-- TODO: this is not found, why not? -->
		<link href="../templates/starter-template.css" rel="stylesheet">

		<script type="text/javascript" src="../static/js/d3.v3.js"></script>
		<script type="text/javascript" src="../static/js/nv.d3.js"></script>
	</head>

	<body>

	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">Can I Solar?</a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li class="active"><a href="#">Home</a></li>
					<li><a href="#about">About</a></li>
					<li><a href="#contact">Contact</a></li>
				</ul>
			</div><!--/.nav-collapse -->
		</div>
    </nav>

	<br><br> 
	
	<!-- To create some extra space at the top -->
	<div class="container">
		<div class="row">
			<br><br>
		</div>
	</div>
	
    <div class="container">
		<form id="myform"  name="myform" class="form-horizontal"  action="/output" method="GET">
		<fieldset>

		<!-- Text input-->
		<div class="form-group">
		  <label class="control-label" for="address">Address</label>
		  <div class="controls">
			<input id="address" name="address" class="input-xlarge" required="" type="text" value="{{ address }}">

		  </div>
		</div>

		<!-- Text input-->
		<div class="form-group">
		  <label class="control-label" for="cost">Most Recent Bill</label>
		  <div class="controls">
			<input id="cost" name="cost" class="input-xlarge" required="" type="text" value="{{ cost }}">

		  </div>
		</div>

		<!-- Select Basic -->
		<div class="form-group">
		  <label class="control-label" for="month">Month of Bill</label>
		  <div class="controls">
			<select id="month" name="month" class="input-xlarge" value = {{ month 	}}>
			  <option value="1">January</option>
			  <option value="2">February</option>
			  <option value="3">March</option>
			  <option value="4">April</option>
			  <option value="5">May</option>
			  <option value="6">June</option>
			  <option value="7">July</option>
			  <option value="8">August</option>
			  <option value="9">September</option>
			  <option value="10">October</option>
			  <option value="11">November</option>
			  <option value="12">December</option>
			</select>
		  </div>
		</div>

		<!-- Script to ensure correct month remains selected after a submission -->
		<script>
			// Get the select element
			var el = document.getElementById("month");
			// Select the option indicated by month (JS indices begin at 0)
			var opt = el.options["{{ month - 1}}"];
			// Set the option to selected
			opt.selected = true;
		</script>		

		<div class="form-group">
			<label class="control-label" for="ann_demand_met">Percentage of Consumption to Meet with Solar Power</label>
			<div class="controls">
				<input id="ann_demand_met" type="range" name="ann_demand_met" style="width: 400px; height: 20px;" onmouseup="slider_mouseUp()" min="0.0" max="1.00" step="0.01" value="{{slider_val}}">
			</div>
		</div>

		<div class="form-group">
			<label class="control-label" for="ann_demand_met">Efficiency of Solar Panels</label>
			<div class="controls">
				<input id="efficiency" type="range" name="efficiency" style="width: 400px; height: 20px;" onmouseup="slider_mouseUp()" min="0.15" max="0.20" step="0.01" value="{{efficiency_slider_val}}">
			</div>
		</div>

		<!-- Script to resubmit the form when a slider is moved -->
		<script>
			function slider_mouseUp() {
				document.myform.action = "/output";
				document.myform.submit();
			}
		</script>

		<!-- Button -->
		<div class="form-group">
			<label class="control-label" for="submit"></label>
			<div class="controls">
				<button id="submitbutton" name="submitbutton" class="btn btn-primary">Submit</button>
			</div>
		</div>

		</fieldset>
		</form>
    </div>

	<div class="container">
		<!--
      <table class="table table-hover">
		  <tr><th>State</th><th>Longitude</th><th>Latitude</th></tr>
		  <tr><td>{{ result['loc']['state'] }}</td><td>{{ result['loc']['lon'] | round(2) }}</td><td> {{ result['loc']['lat'] | round(2) }}</td></tr>
      </table>
      -->

      <table class="table table-hover">
		  <tr><th>Required Nominal Capacity (kW)</th><th>Gross Installation Cost ($)</th><th>Breakeven Time (After 30% Federal Tax Credit, Forecasted Prices, Years)</th></tr>
		  <tr><td>{{ result['nominal_capacity'] | round(1) }}</td><td>{{ result['install_cost_formatted']}}</td><td> {{ result['breakeven'] | round | int }}</td></tr>
      </table>

      <table class="table table-hover">
		  <tr><th>Area Required (square meters)</th><th>Area Required (square feet)</th></tr>
		  <tr><td>{{ result['area_required'] | round | int }}</td><td>{{ (result['area_required'] *  10.7639) | round | int}}</td></tr>
      </table>

     </div>

	<div class="container">
		<p>Click <a href="http://programs.dsireusa.org/system/program?zipcode={{result['loc']['zipcode']}}">here</a> for a list of local renewable energy incentives available in your area.</p>
    </div>

	<div class="container">
		<!-- custom CSS for graph -->
		<style>
			#chart svg {
			  height: 400px;
			}
			#chart2 svg {
			  height: 500px;
			}
			
		</style>

		<div class="row">
			<div class="col-md-6">
				<!-- graph will go here -->
				<div id="chart">
					<svg></svg>
				</div>	
		
				<script type="text/javascript">
					var data = JSON.parse('{{result["graph_json"] | safe	 }}');
					/* console.log(data); */
		
						nv.addGraph(function() {
							var chart = nv.models.linePlusBarChart()
								.margin({top: 30, right: 60, bottom: 50, left: 70})
								.x(function(d,i) { return d[0] })
								.y(function(d,i) {return d[1] })
								;

							
							chart.xAxis.tickFormat(function(d) { console.log(d); return d3.time.format('%b')(new Date(2014, d - 1, 1))
							});
							
							/*chart.y1Axis.tickFormat(function(d) { return d3.format(',f') + 'kWh' (d) });							
							chart.y2Axis.tickFormat(d3.format(',f'));*/

							chart.bars.forceY([0]);
							chart.lines.forceY([0]);
							/* chart.y2Axis.scale().range([0, maxValue + maxValue * 0.10]);	*/						

							d3.select('#chart svg')
								.datum(data)
								.transition()
								.duration(0)
								.call(chart);

							/*nv.utils.windowResize(chart.update);*/

							/*return chart;*/
						});
				</script>
			</div>
			
			<div class="col-md-6">
				<!-- graph will go here -->
				<div id="chart2">
					<svg></svg>
				</div>	
		
				<!-- This is a placeholder for the installation cost vs future electricity prices graph -->
				<!--<script type="text/javascript">
					var data = JSON.parse('{{result["graph_json"] | safe }}');
						nv.addGraph(function() {
							var chart = nv.models.lineChart()
							.useInteractiveGuideline(true)
							;

							chart.xAxis
							.axisLabel('Date')
							.tickFormat(d3.format(',r'))
							;

							chart.yAxis
							.axisLabel('Unrecovered Costs')
							.tickFormat(d3.format('.02f'))
							;

							chart.yAxis
							.axisLabel('Electricity Prices')
							.tickFormat(d3.format('.02f'))
							;

							chart.lines.forceY([0]);

							d3.select('#chart2 svg')
							.datum(data())
							.transition().duration(500)
							.call(chart)
							;

							nv.utils.windowResize(chart.update);

							return chart;
						});

				</script>-->
			</div>			
		</div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> -->
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!--<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script> -->
        
  </body>
</html>