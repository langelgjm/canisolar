<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<!-- TODO: write a description -->
		<meta name="description" content="">
		<meta name="author" content="Gabriel J. Michael">
		<!-- TODO: include a favicon! -->
		<link rel="icon" href="../../favicon.ico">

		<title>Can I Solar?</title>

		<!-- Bootstrap core CSS -->
		<link href="../static/css/bootstrap.min.css" rel="stylesheet">
		<link href="../static/css/nv.d3.css" rel="stylesheet">
		<!-- Custom styles for this template -->
		<!-- TODO: this is not found, why not? -->
		<link href="../templates/starter-template.css" rel="stylesheet">

		<script type="text/javascript" src="../static/js/d3.v3.js"></script>
		<script type="text/javascript" src="../static/js/nv.d3.js"></script>
		
		<!-- Script to update slider value-->
		<script>
			function slider1_input(val) {
				var el = document.getElementById("slider1_span");
				val = Math.floor(val * 100);
				val = val.toString();
				val = val.concat('%')				
				el.innerHTML = val;
			}
		</script>

		<!-- Script to update slider value-->
		<script>
			function slider2_input(val) {
				var el = document.getElementById("slider2_span");
				val = Math.floor(val * 100);
				val = val.toString();
				val = val.concat('%')
				el.innerHTML = val;
			}			
		</script>

		<!-- Script to resubmit the form when a slider is moved -->
		<script>
			function slider_mouseUp() {
				document.myform.action = "/output";
				document.myform.submit();
			}
		</script>
	</head>

	<body>

	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">Can I Solar?</a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li class="active"><a href="/">Home</a></li>
					<li><a href="#about">About</a></li>
					<li><a href="#contact">Contact</a></li>
				</ul>
			</div><!--/.nav-collapse -->
		</div>
    </nav>

	<div class="container">
	
		<div class="row">
			<br><br>
			<br><br>
		</div>
	
	    <div class="row">
		<form id="myform"  role="form" name="myform" class="form-horizontal"  action="/output" method="GET">
  			<div class="col-md-4">
				<!-- Text input-->
				<div class="form-group">
				  <label class="control-label" for="address">Address</label>
				  <div class="controls">
					<input id="address" name="address" class="form-control" required="" type="text" value="{{ data['address'] }}">
				  </div>
				</div>

				<!-- Text input-->
				<div class="form-group">
				  <label class="control-label" for="cost">Most Recent Bill</label>
				  <div class="controls">
					<input id="cost" name="cost" class="form-control" required="" type="text" value="{{ '{:.0f}'.format(data['cost']) }}">

				  </div>
				</div>

				<!-- Select Basic -->
				<div class="form-group">
				  <label class="control-label" for="month">Month of Bill</label>
				  <div class="controls">
					<select id="month" name="month" class="form-control" value ="{{ data['month'] }}">
					  <option value="1">January</option>
					  <option value="2">February</option>
					  <option value="3">March</option>
					  <option value="4">April</option>
					  <option value="5">May</option>
					  <option value="6">June</option>
					  <option value="7">July</option>
					  <option value="8">August</option>
					  <option value="9">September</option>
					  <option value="10">October</option>
					  <option value="11">November</option>
					  <option value="12">December</option>
					</select>
				  </div>
				</div>

				<!-- Button -->
				<div class="form-group">
					<label class="control-label" for="submit"></label>
					<div class="controls">
						<button id="submitbutton" name="submitbutton" class="btn btn-primary">Can I Solar?</button>
					</div>
				</div>				  			
  			</div>
  			<div class="col-md-4"></div>
  			<div class="col-md-4">
				<div class="form-group">
					<label class="control-label" for="ann_demand_met">Consumption Supplied by Solar: <span id="slider1_span">{{ '{0:.0f}'.format(data['ann_demand_met_slider_val'] * 100) }}%</span></label>
					<div class="controls">
						<table>
						<tr>
						<td>0%</td>
						<td>
						<input id="ann_demand_met" class="form-control" type="range" name="ann_demand_met" style="width: 400px; height: 20px;" oninput="slider1_input(this.value)" onmouseup="slider_mouseUp()" min="0.0" max="1.00" step="0.01" value="{{ data['ann_demand_met_slider_val'] }}">
						</td>
						<td>100%</td>
						</tr>
						</table>
					</div>
				</div>

				<div class="form-group">
					<label class="control-label" for="ann_demand_met">Panel Efficiency: <span id="slider2_span">{{ '{0:.0f}'.format(data['efficiency_slider_val'] * 100) }}%</span></label>
					<div class="controls">
						<table>
						<tr>
						<td>15%</td>
						<td>
						<input id="efficiency" class="form-control" type="range" name="efficiency" style="width: 400px; height: 20px;" oninput="slider2_input(this.value)" onmouseup="slider_mouseUp()" min="0.15" max="0.20" step="0.01" value="{{ data['efficiency_slider_val'] }}">
						</td>
						<td>20%</td>
						</tr>
						</table>				
					</div>
				</div>  			
  			</div>
		</form>
		</div>

		<div class="row">
	
			<h4><b><span id="canisolar"></span></b></h4>
	
			<script>
				var el = document.getElementById("canisolar");
				if ("{{data['breakeven']['fit']}}" < 20) {
					el.innerHTML = "You can solar!";
				} else {
					el.innerHTML = "It could take a long time for you to break even on a solar installation.";		
				}
			</script>
	
			<p>
			To meet {{ '{0:.0f}'.format(data['ann_demand_met_slider_val'] * 100) }}% of your annual consumption, you would need a <b>{{ data['req_cap'] | round(1) }} kW solar installation</b>. 
			In {{ data['loc']['state_name'] }}, an installation of this size would most likely cost <b>${{ '{:,.0f}'.format(data['install_cost']['fit']) }}</b>, 
			although could prices vary from a low of ${{ '{:,.0f}'.format(data['install_cost']['lwr']) }} to a high of ${{ '{:,.0f}'.format(data['install_cost']['upr']) }}.
			</p>

			<p>
			Given these installation costs, {{ data['loc']['state_name'] }}'s future electricity prices, and the current 30% federal tax credit, you could expect to break even in <b>{{ '{:.0f}'.format(data['breakeven']['fit']) if data['breakeven']['fit'] != -1 else "more than 30" }} years</b>.
			If your installation costs were lower, you could break even in as few as {{ '{:.0f}'.format(data['breakeven']['lwr']) if data['breakeven']['lwr'] != -1 else "more than 30" }} years; 
			if your installation costs were higher, as many as {{ '{:.0f}'.format(data['breakeven']['upr']) if data['breakeven']['upr'] != -1 else "more than 30" }} years.
			</p>

			<p>
			Solar panels with {{ '{0:.0f}'.format(data['efficiency_slider_val'] * 100) }}% efficiency would require about <b>{{ data['req_area_sqft'] | round | int }} square feet of space</b>.
			</p>
	
			<p>
			<a href="http://programs.dsireusa.org/system/program?zipcode={{ data['loc']['zipcode'] }}">Click here</a> for a list of local renewable energy incentives available in your area that could further reduce your installation costs.
			</p>
		</div>

		<!-- custom CSS for graphs -->
		<style>
			#chart svg {
			  height: 400px;
			}
			#chart2 svg {
			  height: 400px;
			}
			.nvd3.multiChart .axis .nv-axis line { stroke: none; fill: none; }
		</style>

		<div class="row">
			<div class="col-md-6">
				<!-- graph will go here -->
				<div id="chart">
					<svg></svg>
				</div>	

				<script>
					var myData1 = JSON.parse('{{ graph_data["graph1_json"] | safe}}');
					myData1[0].type = "bar";
					myData1[0].yAxis = 1;
					myData1[1].type = "bar";
					myData1[1].yAxis = 1;					
					myData1[2].type = "line";
					myData1[2].yAxis = 2;
					nv.addGraph(function() {
						var chart = nv.models.multiChart()
							.margin({top: 30, right: 60, bottom: 50, left: 70})
							//.color(d3.scale.category10().range());
						chart.xAxis.tickFormat( function(d) { return d3.time.format('%b') (new Date(d)); } );
						chart.yAxis1.tickFormat(d3.format('$,d'));
						chart.yAxis2.tickFormat(d3.format('.1f'));
						
						chart.yDomain1([0,'{{ graph_data["graph1_y1_max"]}}']);
						chart.yDomain2([0,'{{ graph_data["graph1_y2_max"]}}']);
						
						d3.select('#chart svg')
							.datum(myData1)
							.transition().duration(500).call(chart);
						return chart;
					});
				</script>		
			</div>
			<div class="col-md-6">
				<!-- graph will go here -->
				<div id="chart2">
					<svg></svg>
				</div>	

				<script>
					var myData = JSON.parse('{{ graph_data["graph2_json"] | safe }}');
					myData[0].type = "line";
					myData[0].yAxis = 1;
					myData[1].type = "line";
					myData[1].yAxis = 1;
					/*
					testdata[2].type = "line";
					testdata[2].yAxis = 1;
					testdata[3].type = "line";
					testdata[3].yAxis = 2;
					testdata[4].type = "scatter";
					testdata[4].yAxis = 1;
					testdata[5].type = "scatter";
					testdata[5].yAxis = 2;
					testdata[6].type = "bar";
					testdata[6].yAxis = 2;
					testdata[7].type = "bar";
					testdata[7].yAxis = 2;
					testdata[8].type = "bar";
					testdata[8].yAxis = 2;
					*/
					nv.addGraph(function() {
						var chart = nv.models.multiChart()
							.margin({top: 30, right: 60, bottom: 50, left: 70})
							//.color(d3.scale.category10().range());
						chart.xAxis.tickFormat( function(d) { return d3.time.format('%Y') (new Date(d)); } );
						chart.yAxis1.tickFormat(d3.format('$,d'));
						
						chart.yDomain1([0,'{{ graph_data["graph2_y1_max"] }}']);
						
						d3.select('#chart2 svg')
							.datum(myData)
							.transition().duration(500).call(chart);
						return chart;
					});
				</script>
			</div>					
				
		</div>
    </div>

	<!-- Script to ensure correct month remains selected after a submission. Make sure this comes AFTER the actual element exists in the DOM.-->
	<script>
		// Get the select element
		var el = document.getElementById("month");
		// Select the option indicated by month (JS indices begin at 0)
		var opt = el.options["{{ data['month'] - 1 }}"];
		// Set the option to selected
		opt.selected = true;
	</script>		
    
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> -->
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!--<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script> -->
        
  </body>
</html>